networks:
  web:
    external: true

services:
  web:
    image: tylergilman/tylergilman:prod
    networks:
      - web
    labels:
      - "traefik.enable=true"
      - "com.centurylinklabs.watchtower.enable=true"
      - "com.centurylinklabs.watchtower.scope=prod"
      - "traefik.http.routers.tyler.rule=Host(`tylergilman.com`)"
      - "traefik.http.routers.tyler.entrypoints=websecure"
      - "traefik.http.routers.tyler.tls.certresolver=leresolver"
      - "traefik.http.services.tyler.loadbalancer.server.port=8080"
      - "traefik.http.routers.tyler.middlewares=security-headers"
      - "traefik.http.middlewares.security-headers.headers.stsincludesubdomains=true"
      - "traefik.http.middlewares.security-headers.headers.stspreload=true"
      - "traefik.http.middlewares.security-headers.headers.stsseconds=31536000"
      - "traefik.http.middlewares.security-headers.headers.framedeny=true"
      - "traefik.http.middlewares.security-headers.headers.contenttypenosniff=true"
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
    security_opt:
      - no-new-privileges:true
    read_only: true
    tmpfs:
      - /tmp
    user: "1000:1000"
    volumes:
      - blog-data:/app/blog.db
      - ./.env:/app/.env:ro

volumes:
  blog-data:
